<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üìÖ Calendario de Musicales - Ticket Monitor</title>
  
  <link rel="stylesheet" href="/static/css/style.css">
  
  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
  
  <style>
    .calendar-container {
      max-width: 1400px;
      margin: 40px auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    #calendar {
      margin-top: 20px;
    }

    /* Estilo personalizado para eventos */
    .fc-event {
      border-radius: 4px;
      padding: 2px 4px;
      font-size: 0.85rem;
      cursor: pointer;
      border: none !important;
    }

    .fc-event:hover {
      opacity: 0.8;
      transform: scale(1.02);
    }

    /* Colores por tipo de musical */
    .event-wicked { background-color: #9b59b6 !important; }
    .event-book-mormon { background-color: #e74c3c !important; }
    .event-les-miserables { background-color: #3498db !important; }
    .event-rey-leon { background-color: #f39c12 !important; }
    .event-we-will-rock-you { background-color: #e67e22 !important; }
    .event-rent { background-color: #1abc9c !important; }
    .event-six { background-color: #e91e63 !important; }
    .event-default { background-color: #95a5a6 !important; }

    /* Filtros */
    .calendar-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      padding: 15px;
      background: var(--light-pink);
      border-radius: 8px;
    }

    .filter-chip {
      padding: 8px 16px;
      border-radius: 20px;
      border: 2px solid transparent;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      color: white;
      transition: all 0.3s ease;
    }

    .filter-chip:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .filter-chip.active {
      border-color: white;
      box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
    }

    .filter-all {
      background: #34495e;
    }

    .calendar-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
    }
  </style>
</head>
<body class="pink-theme">

  <!-- Header -->
  <header class="topbar">
    <div class="container topbar-inner">
      <div class="brand">
        <div class="logo-badge" aria-hidden="true">üìÖ</div>
        <h1>Calendario de Musicales</h1>
      </div>
      
      <div class="controls">
        <a href="/" class="btn small" style="text-decoration:none">‚Üê Volver al Dashboard</a>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Hero -->
    <div class="catalog-hero">
      <div class="catalog-hero-inner">
        <h1>üìÖ Calendario de Musicales 2025-2026</h1>
        <p class="lead">Consulta las fechas de todos los musicales en cartelera en Madrid</p>
      </div>
    </div>

    <div class="calendar-container">
      <!-- Filtros -->
      <div class="calendar-filters">
        <button class="filter-chip filter-all active" data-musical="all">
          üìã Todos los musicales
        </button>
        <button class="filter-chip event-wicked" data-musical="wicked">
          Wicked
        </button>
        <button class="filter-chip event-book-mormon" data-musical="the book of mormon">
          The Book of Mormon
        </button>
        <button class="filter-chip event-les-miserables" data-musical="les mis√©rables">
          Les Mis√©rables
        </button>
        <button class="filter-chip event-rey-leon" data-musical="el rey le√≥n">
          El Rey Le√≥n
        </button>
        <button class="filter-chip event-we-will-rock-you" data-musical="we will rock you">
          We Will Rock You
        </button>
        <button class="filter-chip event-rent" data-musical="rent">
          RENT
        </button>
        <button class="filter-chip event-six" data-musical="six">
          SIX
        </button>
      </div>

      <!-- Calendario -->
      <div id="calendar"></div>

      <!-- Leyenda -->
      <div class="calendar-legend">
        <div class="legend-item">
          <div class="legend-color event-wicked"></div>
          <span>Wicked</span>
        </div>
        <div class="legend-item">
          <div class="legend-color event-book-mormon"></div>
          <span>The Book of Mormon</span>
        </div>
        <div class="legend-item">
          <div class="legend-color event-les-miserables"></div>
          <span>Les Mis√©rables</span>
        </div>
        <div class="legend-item">
          <div class="legend-color event-rey-leon"></div>
          <span>El Rey Le√≥n</span>
        </div>
        <div class="legend-item">
          <div class="legend-color event-we-will-rock-you"></div>
          <span>We Will Rock You</span>
        </div>
        <div class="legend-item">
          <div class="legend-color event-rent"></div>
          <span>RENT</span>
        </div>
        <div class="legend-item">
          <div class="legend-color event-six"></div>
          <span>SIX</span>
        </div>
        <div class="legend-item">
          <div class="legend-color event-default"></div>
          <span>Otros musicales</span>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <small>Made with üíñ ‚Äî Musical Calendar Monitor</small>
  </footer>

  <!-- FullCalendar JS -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const calendarEl = document.getElementById('calendar');
      let currentFilter = 'all';
      
      // Cargar eventos desde el servidor
      fetch('/api/calendar-events')
        .then(response => response.json())
        .then(events => {
          initCalendar(events);
        })
        .catch(error => {
          console.error('Error loading events:', error);
          calendarEl.innerHTML = '<p style="text-align:center; color:#e74c3c; padding:40px;">‚ùå Error al cargar el calendario. Verifica que events.json existe.</p>';
        });

      function initCalendar(allEvents) {
        const calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth',
          locale: 'es',
          firstDay: 1, // Lunes
          height: 'auto',
          headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,listMonth'
          },
          buttonText: {
            today: 'Hoy',
            month: 'Mes',
            week: 'Semana',
            list: 'Lista'
          },
          events: allEvents,
          
          // Click en evento
          eventClick: function(info) {
            alert(`${info.event.title}\n\nüìç ${info.event.extendedProps.location}\nüìÖ ${info.event.start.toLocaleDateString('es-ES')} - ${info.event.end ? info.event.end.toLocaleDateString('es-ES') : 'Indefinido'}`);
          },
          
          // Tooltip al pasar el rat√≥n
          eventDidMount: function(info) {
            info.el.title = `${info.event.title}\n${info.event.extendedProps.location}`;
          }
        });

        calendar.render();

        // Filtros
        document.querySelectorAll('.filter-chip').forEach(chip => {
          chip.addEventListener('click', function() {
            // Remover active de todos
            document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            this.classList.add('active');
            
            const musical = this.dataset.musical.toLowerCase();
            currentFilter = musical;
            
            // Filtrar eventos
            if (musical === 'all') {
              calendar.removeAllEvents();
              calendar.addEventSource(allEvents);
            } else {
              const filtered = allEvents.filter(e => 
                e.extendedProps.musical.toLowerCase() === musical
              );
              calendar.removeAllEvents();
              calendar.addEventSource(filtered);
            }
          });
        });
      }
    });
  </script>
</body>
</html>