<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üìã Calendar Tests - Ticket Monitor</title>
  
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .test-header {
      background: linear-gradient(135deg, #ff69b4, #ff1493);
      color: white;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
    }
    
    .test-suite {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .test-suite h2 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #ff69b4;
      padding-bottom: 10px;
    }
    
    .test-case {
      padding: 15px;
      margin: 10px 0;
      border-left: 4px solid #ddd;
      background: #f9f9f9;
      border-radius: 4px;
    }
    
    .test-case.pass {
      border-left-color: #28a745;
      background: #d4edda;
    }
    
    .test-case.fail {
      border-left-color: #dc3545;
      background: #f8d7da;
    }
    
    .test-case.pending {
      border-left-color: #ffc107;
      background: #fff3cd;
    }
    
    .test-name {
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .test-status {
      font-size: 0.9em;
      color: #666;
    }
    
    .test-error {
      color: #dc3545;
      font-family: monospace;
      font-size: 0.9em;
      margin-top: 10px;
      padding: 10px;
      background: #fff;
      border-radius: 4px;
    }
    
    .summary {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      margin-top: 30px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .summary-stats {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    
    .stat {
      flex: 1;
      min-width: 150px;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    
    .stat.pass { background: #d4edda; color: #155724; }
    .stat.fail { background: #f8d7da; color: #721c24; }
    .stat.pending { background: #fff3cd; color: #856404; }
    
    .stat-number {
      font-size: 2em;
      font-weight: bold;
      display: block;
    }
    
    .run-tests-btn {
      background: linear-gradient(135deg, #ff69b4, #ff1493);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.1em;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 20px;
    }
    
    .run-tests-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(255, 105, 180, 0.4);
    }
  </style>
</head>
<body>
  <div class="test-header">
    <h1>üìã Calendar Component Tests</h1>
    <p>Comprehensive testing suite for the Musical Calendar functionality</p>
  </div>

  <button class="run-tests-btn" onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>

  <div id="test-results"></div>
  <div id="test-summary" class="summary" style="display:none;"></div>

  <script>
    // Mock data for testing
    const mockEvents = [
      {
        title: "Wicked",
        start: "2025-01-15",
        className: "event-wicked",
        extendedProps: {
          musical: "wicked",
          location: "Teatro Lope de Vega",
          description: "El musical m√°s esperado del a√±o",
          url: "https://example.com/wicked",
          image: "https://via.placeholder.com/320x180"
        }
      },
      {
        title: "El Rey Le√≥n",
        start: "2025-02-20",
        className: "event-rey-leon",
        extendedProps: {
          musical: "el rey le√≥n",
          location: "Teatro Coliseum",
          description: "Un cl√°sico de Disney",
          url: "https://example.com/rey-leon",
          image: ""
        }
      }
    ];

    let testResults = {
      passed: 0,
      failed: 0,
      pending: 0,
      total: 0
    };

    // Test utilities
    function assert(condition, message) {
      if (!condition) {
        throw new Error(message || "Assertion failed");
      }
    }

    function assertEquals(actual, expected, message) {
      if (actual !== expected) {
        throw new Error(message || `Expected ${expected} but got ${actual}`);
      }
    }

    function assertNotNull(value, message) {
      if (value === null || value === undefined) {
        throw new Error(message || "Value is null or undefined");
      }
    }

    function assertContains(haystack, needle, message) {
      if (!haystack.includes(needle)) {
        throw new Error(message || `"${haystack}" does not contain "${needle}"`);
      }
    }

    // Test runner
    function runTest(name, testFn, suiteName) {
      testResults.total++;
      const testElement = document.createElement('div');
      testElement.className = 'test-case pending';
      testElement.innerHTML = `
        <div class="test-name">${name}</div>
        <div class="test-status">‚è≥ Running...</div>
      `;
      
      const suiteElement = document.querySelector(`[data-suite="${suiteName}"]`);
      suiteElement.appendChild(testElement);

      setTimeout(() => {
        try {
          testFn();
          testElement.className = 'test-case pass';
          testElement.innerHTML = `
            <div class="test-name">‚úÖ ${name}</div>
            <div class="test-status">Passed</div>
          `;
          testResults.passed++;
        } catch (error) {
          testElement.className = 'test-case fail';
          testElement.innerHTML = `
            <div class="test-name">‚ùå ${name}</div>
            <div class="test-status">Failed</div>
            <div class="test-error">${error.message}</div>
          `;
          testResults.failed++;
        }
        
        if (testResults.total === testResults.passed + testResults.failed + testResults.pending) {
          showSummary();
        }
      }, 100);
    }

    function createTestSuite(name) {
      const suite = document.createElement('div');
      suite.className = 'test-suite';
      suite.setAttribute('data-suite', name);
      suite.innerHTML = `<h2>${name}</h2>`;
      document.getElementById('test-results').appendChild(suite);
    }

    function showSummary() {
      const summaryEl = document.getElementById('test-summary');
      summaryEl.style.display = 'block';
      
      const passRate = ((testResults.passed / testResults.total) * 100).toFixed(1);
      
      summaryEl.innerHTML = `
        <h2>üìä Test Summary</h2>
        <div class="summary-stats">
          <div class="stat pass">
            <span class="stat-number">${testResults.passed}</span>
            <span>Passed</span>
          </div>
          <div class="stat fail">
            <span class="stat-number">${testResults.failed}</span>
            <span>Failed</span>
          </div>
          <div class="stat">
            <span class="stat-number">${testResults.total}</span>
            <span>Total</span>
          </div>
          <div class="stat ${passRate >= 80 ? 'pass' : 'fail'}">
            <span class="stat-number">${passRate}%</span>
            <span>Pass Rate</span>
          </div>
        </div>
      `;
    }

    // Test Suites
    function testDOMStructure() {
      createTestSuite('DOM Structure Tests');

      runTest('Calendar container exists', () => {
        const container = document.querySelector('.calendar-container');
        assertNotNull(container, 'Calendar container not found');
      }, 'DOM Structure Tests');

      runTest('Calendar element exists', () => {
        const calendar = document.getElementById('calendar');
        assertNotNull(calendar, 'Calendar element not found');
      }, 'DOM Structure Tests');

      runTest('Tooltip element exists', () => {
        const tooltip = document.getElementById('musical-tooltip');
        assertNotNull(tooltip, 'Tooltip element not found');
        assert(tooltip.classList.contains('musical-tooltip'), 'Tooltip missing class');
      }, 'DOM Structure Tests');

      runTest('Filter buttons exist', () => {
        const filters = document.querySelectorAll('.filter-chip');
        assert(filters.length > 0, 'No filter buttons found');
        assert(filters.length >= 7, `Expected at least 7 filters, found ${filters.length}`);
      }, 'DOM Structure Tests');

      runTest('Header contains back button', () => {
        const backButton = document.querySelector('header a[href="/"]');
        assertNotNull(backButton, 'Back button not found');
        assertContains(backButton.textContent, 'Volver', 'Back button text incorrect');
      }, 'DOM Structure Tests');
    }

    function testEventDataStructure() {
      createTestSuite('Event Data Structure Tests');

      runTest('Mock event has required fields', () => {
        const event = mockEvents[0];
        assertNotNull(event.title, 'Event missing title');
        assertNotNull(event.start, 'Event missing start date');
        assertNotNull(event.extendedProps, 'Event missing extendedProps');
      }, 'Event Data Structure Tests');

      runTest('Event extended props are complete', () => {
        const props = mockEvents[0].extendedProps;
        assertNotNull(props.musical, 'Missing musical name');
        assertNotNull(props.location, 'Missing location');
        assertNotNull(props.description, 'Missing description');
        assertNotNull(props.url, 'Missing URL');
      }, 'Event Data Structure Tests');

      runTest('Event has valid className', () => {
        const event = mockEvents[0];
        assertContains(event.className, 'event-', 'Invalid className format');
      }, 'Event Data Structure Tests');

      runTest('Placeholder image for missing images', () => {
        const event = mockEvents[1];
        assert(event.extendedProps.image === '', 'Expected empty image string');
      }, 'Event Data Structure Tests');
    }

    function testTooltipGeneration() {
      createTestSuite('Tooltip Generation Tests');

      runTest('Tooltip has correct image element', () => {
        const tooltip = document.getElementById('musical-tooltip');
        // Simulate tooltip content
        tooltip.innerHTML = `<img src="test.jpg" class="tooltip-image" alt="Test">`;
        const img = tooltip.querySelector('.tooltip-image');
        assertNotNull(img, 'Tooltip image not found');
      }, 'Tooltip Generation Tests');

      runTest('Tooltip generates Google Maps link', () => {
        const location = "Teatro Lope de Vega";
        const expectedUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location + ', Madrid')}`;
        assertContains(expectedUrl, 'maps.google.com', 'Invalid maps URL');
      }, 'Tooltip Generation Tests');

      runTest('Tooltip handles missing data gracefully', () => {
        const props = {
          image: '',
          description: undefined,
          location: undefined,
          url: undefined
        };
        
        const description = props.description || 'Disfruta de este incre√≠ble musical en Madrid';
        const location = props.location || 'Madrid';
        const url = props.url || '#';
        
        assertEquals(description, 'Disfruta de este incre√≠ble musical en Madrid', 'Default description not set');
        assertEquals(location, 'Madrid', 'Default location not set');
        assertEquals(url, '#', 'Default URL not set');
      }, 'Tooltip Generation Tests');

      runTest('Tooltip button conditional rendering', () => {
        const urlPresent = 'https://example.com';
        const urlMissing = '#';
        
        assert(urlPresent !== '#', 'Should show button when URL is present');
        assert(urlMissing === '#', 'Should hide button when URL is missing');
      }, 'Tooltip Generation Tests');
    }

    function testFilterFunctionality() {
      createTestSuite('Filter Functionality Tests');

      runTest('All filters have data-musical attribute', () => {
        const filters = document.querySelectorAll('.filter-chip');
        filters.forEach(filter => {
          assertNotNull(filter.getAttribute('data-musical'), 'Filter missing data-musical');
        });
      }, 'Filter Functionality Tests');

      runTest('Default filter is active', () => {
        const activeFilter = document.querySelector('.filter-chip.active');
        assertNotNull(activeFilter, 'No active filter found');
        assertEquals(activeFilter.getAttribute('data-musical'), 'all', 'Default filter should be "all"');
      }, 'Filter Functionality Tests');

      runTest('Filter event matching logic', () => {
        const musicalName = 'wicked';
        const event = mockEvents[0];
        const matches = event.extendedProps.musical.toLowerCase() === musicalName;
        assert(matches, 'Event should match filter');
      }, 'Filter Functionality Tests');

      runTest('Filter color classes match event classes', () => {
        const filterClasses = ['event-wicked', 'event-book-mormon', 'event-les-miserables'];
        const eventClasses = mockEvents.map(e => e.className);
        
        filterClasses.forEach(fc => {
          // Just verify format is consistent
          assert(fc.startsWith('event-'), `Filter class ${fc} has wrong format`);
        });
      }, 'Filter Functionality Tests');
    }

    function testResponsiveness() {
      createTestSuite('Responsiveness Tests');

      runTest('Tooltip positioning calculations', () => {
        const tooltipWidth = 320;
        const tooltipHeight = 550;
        const mouseX = 100;
        const mouseY = 100;
        
        let left = mouseX + 15;
        let top = mouseY - 50;
        
        assert(left === 115, 'Tooltip left position incorrect');
        assert(top === 50, 'Tooltip top position incorrect');
      }, 'Responsiveness Tests');

      runTest('Tooltip boundary detection', () => {
        const tooltipWidth = 320;
        const windowWidth = 800;
        const mouseX = 700;
        
        let left = mouseX + 15;
        if (left + tooltipWidth > windowWidth) {
          left = mouseX - tooltipWidth - 15;
        }
        
        assert(left < windowWidth, 'Tooltip should stay within window bounds');
      }, 'Responsiveness Tests');

      runTest('Calendar container has max-width', () => {
        const container = document.querySelector('.calendar-container');
        const styles = window.getComputedStyle(container);
        assertNotNull(styles.maxWidth, 'Container should have max-width');
      }, 'Responsiveness Tests');
    }

    function testAccessibility() {
      createTestSuite('Accessibility Tests');

      runTest('Page has proper lang attribute', () => {
        const html = document.documentElement;
        assertEquals(html.getAttribute('lang'), 'es', 'Lang attribute should be "es"');
      }, 'Accessibility Tests');

      runTest('Images have alt attributes', () => {
        // This would be tested when tooltip is rendered
        const altText = 'Musical poster';
        assertNotNull(altText, 'Alt text should be provided');
      }, 'Accessibility Tests');

      runTest('Links have meaningful text', () => {
        const backButton = document.querySelector('header a');
        assert(backButton.textContent.trim().length > 0, 'Link should have text');
      }, 'Accessibility Tests');

      runTest('Buttons are keyboard accessible', () => {
        const filters = document.querySelectorAll('.filter-chip');
        filters.forEach(filter => {
          assert(filter.tagName === 'BUTTON', 'Filters should be buttons');
        });
      }, 'Accessibility Tests');
    }

    function runAllTests() {
      // Reset
      document.getElementById('test-results').innerHTML = '';
      document.getElementById('test-summary').style.display = 'none';
      testResults = { passed: 0, failed: 0, pending: 0, total: 0 };

      // Run all test suites
      testDOMStructure();
      testEventDataStructure();
      testTooltipGeneration();
      testFilterFunctionality();
      testResponsiveness();
      testAccessibility();
    }

    // Auto-run tests on load
    window.addEventListener('load', () => {
      setTimeout(runAllTests, 500);
    });
  </script>

  <!-- Include calendar styles for testing -->
  <div style="display:none;">
    <div class="calendar-container">
      <div class="calendar-filters">
        <button class="filter-chip filter-all active" data-musical="all">üìã Todos</button>
        <button class="filter-chip event-wicked" data-musical="wicked">Wicked</button>
        <button class="filter-chip event-book-mormon" data-musical="the book of mormon">Book of Mormon</button>
        <button class="filter-chip event-les-miserables" data-musical="les mis√©rables">Les Mis√©rables</button>
        <button class="filter-chip event-rey-leon" data-musical="el rey le√≥n">El Rey Le√≥n</button>
        <button class="filter-chip event-cabaret" data-musical="cabaret">Cabaret</button>
        <button class="filter-chip event-houdini" data-musical="houdini">Houdini</button>
      </div>
      <div id="calendar"></div>
    </div>
    <div id="musical-tooltip" class="musical-tooltip"></div>
  </div>

</body>
</html>