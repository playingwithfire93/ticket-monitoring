<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üìÖ Calendario de Musicales - Ticket Monitor</title>
  
  <link rel="stylesheet" href="/static/css/style.css">
  
  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
  
  <style>
    .calendar-container {
      max-width: 1400px;
      margin: 40px auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    #calendar {
      margin-top: 20px;
    }

    /* Estilo personalizado para eventos */
    .fc-event {
      border-radius: 4px;
      padding: 2px 4px;
      font-size: 0.85rem;
      cursor: pointer;
      border: none !important;
      position: relative;
    }

    .fc-event:hover {
      opacity: 0.9;
      transform: scale(1.02);
      z-index: 100;
    }

    /* Tooltip/Card hover mejorado */
    .event-item {
      position: relative;
      cursor: pointer;
    }

    .event-tooltip {
      position: fixed; /* ‚Üê Cambio clave: fixed en vez de absolute */
      display: none;
      background: white;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
      z-index: 9999;
      min-width: 300px;
      max-width: 400px;
      pointer-events: none; /* No interfiere con el hover */
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .event-item:hover .event-tooltip {
      display: block;
      opacity: 1;
    }

    /* Flecha del tooltip (arriba o abajo seg√∫n posici√≥n) */
    .event-tooltip::before {
      content: '';
      position: absolute;
      width: 0;
      height: 0;
      border: 8px solid transparent;
    }

    /* Flecha apuntando abajo (tooltip arriba del elemento) */
    .event-tooltip.tooltip-top::before {
      bottom: -16px;
      left: 50%;
      transform: translateX(-50%);
      border-top-color: white;
      border-bottom: none;
    }

    /* Flecha apuntando arriba (tooltip abajo del elemento) */
    .event-tooltip.tooltip-bottom::before {
      top: -16px;
      left: 50%;
      transform: translateX(-50%);
      border-bottom-color: white;
      border-top: none;
    }

    /* Contenido del tooltip */
    .tooltip-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 2px solid #f0f0f0;
    }

    .tooltip-icon {
      font-size: 2rem;
    }

    .tooltip-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: #333;
      margin: 0;
    }

    .tooltip-body {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .tooltip-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      color: #666;
    }

    .tooltip-row strong {
      color: #333;
      min-width: 80px;
    }

    .tooltip-badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .tooltip-badge.available {
      background: #d4edda;
      color: #155724;
    }

    .tooltip-badge.sold-out {
      background: #f8d7da;
      color: #721c24;
    }

    /* Filtros */
    .calendar-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      padding: 15px;
      background: var(--light-pink);
      border-radius: 8px;
    }

    .filter-chip {
      padding: 8px 16px;
      border-radius: 20px;
      border: 2px solid transparent;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      color: white;
      transition: all 0.3s ease;
    }

    .filter-chip:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .filter-chip.active {
      border-color: white;
      box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
    }

    .filter-all { background: #34495e; }

    /* COLORES PARA CADA MUSICAL */
    .event-wicked { 
      background: linear-gradient(135deg, #2ecc71, #27ae60) !important;
      border-left: 4px solid #229954 !important;
    }

    .event-book-mormon { 
      background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
      border-left: 4px solid #a93226 !important;
    }

    .event-les-miserables { 
      background: linear-gradient(135deg, #3498db, #2980b9) !important;
      border-left: 4px solid #1f618d !important;
    }

    .event-rey-leon { 
      background: linear-gradient(135deg, #f39c12, #e67e22) !important;
      border-left: 4px solid #d68910 !important;
    }

    .event-cabaret { 
      background: linear-gradient(135deg, #34495e, #2c3e50) !important;
      border-left: 4px solid #1c2833 !important;
    }

    .event-houdini { 
      background: linear-gradient(135deg, #e67e22, #d35400) !important;
      border-left: 4px solid #ba4a00 !important;
    }

    .event-cenicienta { 
      background: linear-gradient(135deg, #ec407a, #d81b60) !important;
      border-left: 4px solid #ad1457 !important;
    }

    .event-oliver-twist { 
      background: linear-gradient(135deg, #78909c, #607d8b) !important;
      border-left: 4px solid #455a64 !important;
    }

    .event-raffaella { 
      background: linear-gradient(135deg, #ab47bc, #8e24aa) !important;
      border-left: 4px solid #6a1b9a !important;
    }

    .event-pilares { 
      background: linear-gradient(135deg, #26a69a, #00897b) !important;
      border-left: 4px solid #00695c !important;
    }

    /* Default para musicales no especificados */
    .fc-event {
      background: linear-gradient(135deg, #95a5a6, #7f8c8d) !important;
      border-left: 4px solid #626567 !important;
    }

    /* Mejorar hover */
    .fc-event:hover {
      opacity: 0.85 !important;
      transform: scale(1.05) !important;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
    }

    /* Filtros con colores matching */
    .filter-chip {
      padding: 8px 16px;
      border-radius: 20px;
      border: 2px solid transparent;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      color: white;
      transition: all 0.3s ease;
    }

    .filter-chip:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .filter-chip.active {
      border-color: white;
      box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
      transform: scale(1.05);
    }

    .filter-all { 
      background: linear-gradient(135deg, #34495e, #2c3e50); 
    }

    .filter-chip.event-wicked { 
      background: linear-gradient(135deg, #2ecc71, #27ae60); 
    }

    .filter-chip.event-book-mormon { 
      background: linear-gradient(135deg, #e74c3c, #c0392b); 
    }

    .filter-chip.event-les-miserables { 
      background: linear-gradient(135deg, #3498db, #2980b9); 
    }

    .filter-chip.event-rey-leon { 
      background: linear-gradient(135deg, #f39c12, #e67e22); 
    }

    .filter-chip.event-cabaret { 
      background: linear-gradient(135deg, #34495e, #2c3e50); 
    }

    .filter-chip.event-houdini { 
      background: linear-gradient(135deg, #e67e22, #d35400); 
    }

    .filter-chip.event-cenicienta { 
      background: linear-gradient(135deg, #ec407a, #d81b60); 
    }

    .filter-chip.event-oliver-twist { 
      background: linear-gradient(135deg, #78909c, #607d8b); 
    }

    .filter-chip.event-raffaella { 
      background: linear-gradient(135deg, #ab47bc, #8e24aa); 
    }

    .filter-chip.event-pilares { 
      background: linear-gradient(135deg, #26a69a, #00897b); 
    }

    /* Leyenda de colores (opcional) */
    .calendar-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .event-tooltip {
        min-width: 250px;
        max-width: 90vw;
      }
    }

    /* TOOLTIP MEJORADO - Aparece donde est√° el cursor */
    .musical-tooltip {
      position: fixed;
      display: none;
      background: white;
      border-radius: 16px;
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3);
      z-index: 10000;
      width: 380px;
      max-width: 90vw;
      overflow: hidden;
      opacity: 0;
      transform: scale(0.9);
      transition: opacity 0.2s ease, transform 0.2s ease;
      pointer-events: none; /* ‚Üê CLAVE: No bloquea el hover */
    }

    .musical-tooltip.active {
      display: block;
      opacity: 1;
      transform: scale(1);
      pointer-events: auto; /* ‚Üê Permitir clicks en los botones */
    }

    /* Imagen del tooltip */
    .tooltip-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 16px 16px 0 0;
    }

    /* Contenido del tooltip */
    .tooltip-content {
      padding: 20px;
    }

    .tooltip-title {
      font-size: 1.4rem;
      font-weight: 800;
      color: #ff69b4;
      margin: 0 0 12px 0;
    }

    .tooltip-meta {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 12px;
    }

    .tooltip-meta-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
      color: #666;
    }

    .tooltip-meta-item span {
      font-size: 1.2rem;
    }

    .tooltip-location-link {
      color: #3498db;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.2s ease;
    }

    .tooltip-location-link:hover {
      color: #2980b9;
      text-decoration: underline;
    }

    .tooltip-description {
      font-size: 0.9rem;
      color: #666;
      line-height: 1.5;
      margin: 0 0 16px 0;
    }

    /* Botones del tooltip */
    .tooltip-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .tooltip-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.95rem;
      text-decoration: none;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .tooltip-button-primary {
      background: linear-gradient(135deg, #ff69b4, #ff1493);
      color: white;
    }

    .tooltip-button-primary:hover {
      background: linear-gradient(135deg, #ff1493, #c71585);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 105, 180, 0.4);
    }

    .tooltip-button-secondary {
      background: #f0f0f0;
      color: #333;
    }

    .tooltip-button-secondary:hover {
      background: #e0e0e0;
      transform: translateY(-2px);
    }

    /* Badge de disponibilidad */
    .tooltip-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .tooltip-badge.available {
      background: #d4edda;
      color: #155724;
    }

    .tooltip-badge.sold-out {
      background: #f8d7da;
      color: #721c24;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .musical-tooltip {
        width: 320px;
      }

      .tooltip-image {
        height: 160px;
      }

      .tooltip-content {
        padding: 16px;
      }

      .tooltip-title {
        font-size: 1.2rem;
      }
    }

    /* A√±ade este CSS en el <style> del calendario */

.event-card {
  position: relative;
  transition: all 0.3s ease;
  cursor: pointer;
}

.event-card:hover {
  box-shadow: 0 15px 50px rgba(241, 124, 216, 0.6) !important;
  transform: scale(1.05);
}
  </style>

  <!-- A√±ade esto en el <head> -->
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>
  <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/scale.css"/>

  <script>
    // Inicializar tooltips con Tippy.js
    document.addEventListener('DOMContentLoaded', () => {
      tippy('.event-item', {
        content(reference) {
          const template = reference.querySelector('.event-tooltip');
          return template ? template.innerHTML : 'Sin informaci√≥n';
        },
        allowHTML: true,
        placement: 'auto', // ‚Üê Se posiciona autom√°ticamente
        interactive: true,
        animation: 'scale',
        theme: 'light-border',
        maxWidth: 400,
        offset: [0, 10],
      });
    });
  </script>

  <style>
    /* Tema custom para Tippy.js */
    .tippy-box[data-theme~='light-border'] {
      background-color: white;
      color: #333;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
      border-radius: 12px;
    }

    .tippy-box[data-theme~='light-border'][data-placement^='top'] > .tippy-arrow::before {
      border-top-color: white;
    }

    .tippy-box[data-theme~='light-border'][data-placement^='bottom'] > .tippy-arrow::before {
      border-bottom-color: white;
    }

    /* Ocultar el tooltip inline (Tippy lo clonar√°) */
    .event-tooltip {
      display: none;
    }
  </style>
</head>
<body class="pink-theme">

  <!-- Header -->
  <header class="topbar">
    <div class="container topbar-inner">
      <div class="brand">
        <div class="logo-badge" aria-hidden="true">üìÖ</div>
        <h1>Calendario de Musicales</h1>
      </div>
      
      <div class="controls">
        <a href="/" class="btn small" style="text-decoration:none">‚Üê Volver al Dashboard</a>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Hero -->
    <div class="catalog-hero">
      <div class="catalog-hero-inner">
        <h1>üìÖ Calendario de Musicales 2025-2026</h1>
        <p class="lead">Pasa el rat√≥n sobre un musical para ver m√°s informaci√≥n</p>
      </div>
    </div>

    <div class="calendar-container">
      <!-- Filtros -->
      <div class="calendar-filters">
        <button class="filter-chip filter-all active" data-musical="all">
          üìã Todos los musicales
        </button>
        <button class="filter-chip event-wicked" data-musical="wicked">
          Wicked
        </button>
        <button class="filter-chip event-book-mormon" data-musical="the book of mormon">
          The Book of Mormon
        </button>
        <button class="filter-chip event-les-miserables" data-musical="les mis√©rables">
          Les Mis√©rables
        </button>
        <button class="filter-chip event-rey-leon" data-musical="el rey le√≥n">
          El Rey Le√≥n
        </button>
        <button class="filter-chip event-cabaret" data-musical="cabaret">
          Cabaret
        </button>
        <button class="filter-chip event-houdini" data-musical="houdini">
          Houdini
        </button>
      </div>

      <!-- Calendario -->
      <div id="calendar"></div>
      
      <!-- Leyenda de colores -->
      <div class="calendar-legend">
        <h4 style="width: 100%; margin: 0 0 10px 0; color: #333;">üé® Leyenda de Musicales:</h4>
        
        <div class="legend-item">
          <div class="legend-color" style="background: linear-gradient(135deg, #2ecc71, #27ae60);"></div>
          <span>Wicked</span>
        </div>
        
        <div class="legend-item">
          <div class="legend-color" style="background: linear-gradient(135deg, #e74c3c, #c0392b);"></div>
          <span>The Book of Mormon</span>
        </div>
        
        <div class="legend-item">
          <div class="legend-color" style="background: linear-gradient(135deg, #3498db, #2980b9);"></div>
          <span>Les Mis√©rables</span>
        </div>
        
        <div class="legend-item">
          <div class="legend-color" style="background: linear-gradient(135deg, #f39c12, #e67e22);"></div>
          <span>El Rey Le√≥n</span>
        </div>
        
        <div class="legend-item">
          <div class="legend-color" style="background: linear-gradient(135deg, #34495e, #2c3e50);"></div>
          <span>Cabaret</span>
        </div>
        
        <div class="legend-item">
          <div class="legend-color" style="background: linear-gradient(135deg, #e67e22, #d35400);"></div>
          <span>Houdini</span>
        </div>
        
        <div class="legend-item">
          <div class="legend-color" style="background: linear-gradient(135deg, #ec407a, #d81b60);"></div>
          <span>Cenicienta</span>
        </div>
        
        <div class="legend-item">
          <div class="legend-color" style="background: linear-gradient(135deg, #78909c, #607d8b);"></div>
          <span>Oliver Twist</span>
        </div>
        
        <div class="legend-item">
          <div class="legend-color" style="background: linear-gradient(135deg, #ab47bc, #8e24aa);"></div>
          <span>Raffaella</span>
        </div>
        
        <div class="legend-item">
          <div class="legend-color" style="background: linear-gradient(135deg, #26a69a, #00897b);"></div>
          <span>Los Pilares de la Tierra</span>
        </div>
      </div>
    </div>
  </main>

  <!-- Tooltip flotante -->
  <div id="musical-tooltip" class="musical-tooltip"></div>

  <footer class="footer">
    <small>Made with üíñ ‚Äî Musical Calendar Monitor</small>
  </footer>

  <!-- FullCalendar JS -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const calendarEl = document.getElementById('calendar');
      const tooltipEl = document.getElementById('musical-tooltip');
      let currentFilter = 'all';
      let hideTimeout;
      let isMouseOverTooltip = false;
      let isMouseOverEvent = false;
      
      // Cargar eventos desde el servidor
      fetch('/api/calendar-events')
        .then(response => response.json())
        .then(events => {
          console.log(`‚úÖ Cargados ${events.length} eventos`);
          initCalendar(events);
        })
        .catch(error => {
          console.error('Error loading events:', error);
          calendarEl.innerHTML = '<p style="text-align:center; color:#e74c3c; padding:40px;">‚ùå Error al cargar el calendario</p>';
        });

      function initCalendar(allEvents) {
        const calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth',
          locale: 'es',
          firstDay: 1,
          height: 'auto',
          headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,listMonth'
          },
          buttonText: {
            today: 'Hoy',
            month: 'Mes',
            list: 'Lista'
          },
          events: allEvents,
          
          // ‚úÖ A√ëADE ESTO: Asigna las clases CSS seg√∫n el musical
          eventClassNames: function(info) {
            const musical = (info.event.extendedProps.musical || '').toLowerCase();
            
            const classMap = {
              'wicked': 'event-wicked',
              'the book of mormon': 'event-book-mormon',
              'les mis√©rables': 'event-les-miserables',
              'el rey le√≥n': 'event-rey-leon',
              'cabaret': 'event-cabaret',
              'houdini': 'event-houdini',
              'cenicienta': 'event-cenicienta',
              'oliver twist': 'event-oliver-twist',
              'raffaella': 'event-raffaella',
              'los pilares de la tierra': 'event-pilares'
            };
            
            return classMap[musical] || 'fc-event-default';
          },
          
          // Hover para mostrar tooltip
          eventMouseEnter: function(info) {
            clearTimeout(hideTimeout);
            isMouseOverEvent = true;
            showTooltip(info.event, info.jsEvent);
          },
          
          eventMouseLeave: function() {
            isMouseOverEvent = false;
            hideTimeout = setTimeout(() => {
              if (!isMouseOverTooltip && !isMouseOverEvent) {
                tooltipEl.classList.remove('active');
              }
            }, 200);
          }
        });

        calendar.render();

        // Mantener tooltip visible al hacer hover sobre √©l
        tooltipEl.addEventListener('mouseenter', () => {
          clearTimeout(hideTimeout);
          isMouseOverTooltip = true;
        });

        tooltipEl.addEventListener('mouseleave', () => {
          isMouseOverTooltip = false;
          hideTimeout = setTimeout(() => {
            if (!isMouseOverEvent) {
              tooltipEl.classList.remove('active');
            }
          }, 200);
        });

        // Filtros
        document.querySelectorAll('.filter-chip').forEach(chip => {
          chip.addEventListener('click', function() {
            document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            this.classList.add('active');
            
            const musical = this.dataset.musical.toLowerCase();
            
            if (musical === 'all') {
              calendar.removeAllEvents();
              calendar.addEventSource(allEvents);
            } else {
              const filtered = allEvents.filter(e => 
                e.extendedProps.musical.toLowerCase() === musical
              );
              calendar.removeAllEvents();
              calendar.addEventSource(filtered);
            }
          });
        });
      }

      function showTooltip(event, mouseEvent) {
        const props = event.extendedProps || {};
        
        // ARREGLADO: Usar placeholder si no hay imagen o si es default.jpg
        let image = props.image || '';
        
        // Si la imagen es vac√≠a o termina en default.jpg, usar placeholder
        if (!image || image.includes('default.jpg')) {
          image = `https://via.placeholder.com/320x180/ff69b4/ffffff?text=${encodeURIComponent(event.title.substring(0, 20))}`;
        }
        
        const description = props.description || 'Disfruta de este incre√≠ble musical en Madrid';
        const location = props.location || 'Madrid';
        const url = props.url || '#';
        
        // Crear enlace de Google Maps
        const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location + ', Madrid')}`;
        
        // Debug
        console.log('üé≠ Musical:', event.title);
        console.log('üì∏ Imagen:', image);
        console.log('üîó URL:', url);
        console.log('üìç Maps:', mapsUrl);
        
        tooltipEl.innerHTML = `
          <img 
            src="${image}" 
            alt="${event.title}" 
            class="tooltip-image" 
            onerror="this.src='https://via.placeholder.com/320x180/ff69b4/ffffff?text=Musical';"
          >
          <div class="tooltip-content">
            <h3 class="tooltip-title">${event.title}</h3>
            <div class="tooltip-meta">
              <div class="tooltip-meta-item">
                <span>üìç</span>
                <a href="${mapsUrl}" target="_blank" class="tooltip-location-link" onclick="event.stopPropagation()">
                  ${location}
                </a>
              </div>
            </div>
            <p class="tooltip-description">${description}</p>
            <div class="tooltip-buttons">
              ${url !== '#' ? `<a href="${url}" target="_blank" class="tooltip-button tooltip-button-primary" onclick="event.stopPropagation()">üéüÔ∏è Comprar Entradas</a>` : ''}
              <a href="${mapsUrl}" target="_blank" class="tooltip-button tooltip-button-secondary" onclick="event.stopPropagation()">üó∫Ô∏è Ver en Google Maps</a>
            </div>
          </div>
        `;
        
        // Posicionar tooltip
        const tooltipWidth = 320;
        const tooltipHeight = 550;
        
        let left = mouseEvent.pageX + 15;
        let top = mouseEvent.pageY - 50;
        
        if (left + tooltipWidth > window.innerWidth) {
          left = mouseEvent.pageX - tooltipWidth - 15;
        }
        
        if (top + tooltipHeight > window.innerHeight + window.scrollY) {
          top = window.innerHeight + window.scrollY - tooltipHeight - 20;
        }
        
        if (top < window.scrollY) {
          top = window.scrollY + 20;
        }
        
        tooltipEl.style.left = left + 'px';
        tooltipEl.style.top = top + 'px';
        tooltipEl.classList.add('active');
      }
    });
  </script>

  <script>
    // ==================== POSICIONAMIENTO INTELIGENTE DEL TOOLTIP ====================
    document.addEventListener('DOMContentLoaded', () => {
      const eventItems = document.querySelectorAll('.event-item');

      eventItems.forEach(item => {
        const tooltip = item.querySelector('.event-tooltip');
        if (!tooltip) return;

        item.addEventListener('mouseenter', (e) => {
          positionTooltip(item, tooltip);
        });

        // Reposicionar al mover el mouse (opcional, para mejor experiencia)
        item.addEventListener('mousemove', () => {
          positionTooltip(item, tooltip);
        });
      });

      function positionTooltip(item, tooltip) {
        const itemRect = item.getBoundingClientRect();
        const tooltipRect = tooltip.getBoundingClientRect();
        const viewportHeight = window.innerHeight;
        const viewportWidth = window.innerWidth;

        // Calcular espacio disponible arriba y abajo
        const spaceAbove = itemRect.top;
        const spaceBelow = viewportHeight - itemRect.bottom;

        // Decidir si mostrar arriba o abajo
        const showAbove = spaceBelow < tooltipRect.height + 20 && spaceAbove > spaceBelow;

        if (showAbove) {
          // Mostrar arriba
          tooltip.style.top = `${itemRect.top - tooltipRect.height - 10}px`;
          tooltip.classList.add('tooltip-top');
          tooltip.classList.remove('tooltip-bottom');
        } else {
          // Mostrar abajo
          tooltip.style.top = `${itemRect.bottom + 10}px`;
          tooltip.classList.add('tooltip-bottom');
          tooltip.classList.remove('tooltip-top');
        }

        // Centrar horizontalmente, pero ajustar si se sale de la pantalla
        let left = itemRect.left + (itemRect.width / 2) - (tooltipRect.width / 2);

        // Ajustar si se sale por la izquierda
        if (left < 10) {
          left = 10;
        }

        // Ajustar si se sale por la derecha
        if (left + tooltipRect.width > viewportWidth - 10) {
          left = viewportWidth - tooltipRect.width - 10;
        }

        tooltip.style.left = `${left}px`;
      }
    });
  </script>

  <!-- A√±ade este script al final, antes de </body> -->
  <script>
// ==================== TOOLTIP CARD POSITIONING ====================
let tooltipCard = null;

document.querySelectorAll('.event-card').forEach(card => {
  card.addEventListener('mouseenter', function(e) {
    tooltipCard = this;
    updateTooltipPosition(e);
  });

  card.addEventListener('mousemove', function(e) {
    if (tooltipCard === this) {
      updateTooltipPosition(e);
    }
  });

  card.addEventListener('mouseleave', function() {
    if (tooltipCard === this) {
      tooltipCard.style.position = '';
      tooltipCard.style.left = '';
      tooltipCard.style.top = '';
      tooltipCard.style.zIndex = '';
    }
    tooltipCard = null;
  });
});

function updateTooltipPosition(e) {
  if (!tooltipCard) return;

  const offset = 15;
  const x = e.clientX + offset;
  const y = e.clientY + offset;

  const cardWidth = tooltipCard.offsetWidth;
  const cardHeight = tooltipCard.offsetHeight;

  const maxX = window.innerWidth - cardWidth - 20;
  const maxY = window.innerHeight - cardHeight - 20;

  tooltipCard.style.position = 'fixed';
  tooltipCard.style.left = Math.min(x, maxX) + 'px';
  tooltipCard.style.top = Math.min(y, maxY) + 'px';
  tooltipCard.style.zIndex = '9999';
  tooltipCard.style.width = cardWidth + 'px';
}
</script>
</body>
</html>