<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üéüÔ∏è Ticket Monitor Dashboard</title>
  
  <link rel="stylesheet" href="/static/css/style.css">
  
  <style>
  /* VIDEO HERO BANNER (secci√≥n amarilla) */
  .catalog-hero {
    position: relative;
    overflow: hidden;
    min-height: 500px;
    border-radius: 50px;
    margin: 2rem 0;
    border: 5px solid #f17cd8;
    box-shadow: 
      0 0 25px rgba(241, 124, 216, 0.4),
      inset 0 0 25px rgba(241, 124, 216, 0.1);
    animation: borderFadeSubtle 4s ease-in-out infinite alternate;
  }

  @keyframes borderFadeSubtle {
    0% {
      box-shadow: 
        0 0 15px rgba(241, 124, 216, 0.3),
        inset 0 0 15px rgba(241, 124, 216, 0.05);
      border-color: rgba(241, 124, 216, 0.8);
    }
    100% {
      box-shadow: 
        0 0 35px rgba(241, 124, 216, 0.6),
        inset 0 0 35px rgba(241, 124, 216, 0.15);
      border-color: rgba(241, 124, 216, 1);
    }
  }

  .video-hero-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
  }

  .video-hero-background video {
    position: absolute;
    top: 50%;
    left: 50%;
    min-width: 100%;
    min-height: 100%;
    width: auto;
    height: auto;
    transform: translate(-50%, -50%);
    object-fit: cover;
    opacity: 0;
    transition: opacity 1.5s ease-in-out;
  }

  .video-hero-background video.active {
    opacity: 1;
    z-index: 1;
  }

  .video-hero-background iframe {
    position: absolute;
    top: 50%;
    left: 50%;
    min-width: 100%;
    min-height: 100%;
    width: 100vw;
    height: 56.25vw; /* Ratio 16:9 */
    min-height: 100vh;
    min-width: 177.77vh; /* Ratio 16:9 */
    transform: translate(-50%, -50%);
    object-fit: cover;
    opacity: 0;
    transition: opacity 1.5s ease-in-out;
    pointer-events: none;
    z-index: 0;
  }

  .video-hero-background iframe.active {
    opacity: 1;
    z-index: 1;
    pointer-events: auto;
  }

  /* Overlay MUY ligero solo para mejorar legibilidad del texto */
  .catalog-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    /* ‚¨áÔ∏è CAMBIO CLAVE: Gradiente suave solo arriba y abajo */
    background: linear-gradient(
      to bottom,
      rgba(255, 192, 203, 0.3) 0%,    /* Rosa muy ligero arriba */
      rgba(255, 192, 203, 0.1) 30%,   /* Casi transparente en el medio */
      rgba(255, 192, 203, 0.1) 70%,   /* Casi transparente en el medio */
      rgba(255, 192, 203, 0.3) 100%   /* Rosa muy ligero abajo */
    );
    border-radius: 42px; /* Match el border-radius del contenedor */
    z-index: 2;
    pointer-events: none;
  }

  /* Contenido sobre los videos */
  .catalog-hero-inner {
    position: relative;
    z-index: 3;
    text-align: center;
    padding: 80px 20px;
  }

  /* Texto con sombra fuerte para que se vea sobre el video */
  .catalog-hero h1 {
    color: white; /* ‚Üê Cambio a blanco para mejor contraste */
    font-size: 3.5rem;
    font-weight: 900;
    margin-bottom: 1rem;
    text-shadow: 
      3px 3px 8px rgba(0, 0, 0, 0.8),
      -1px -1px 4px rgba(0, 0, 0, 0.6),
      0 0 20px rgba(255, 192, 203, 0.8); /* Glow rosa */
    letter-spacing: 2px;
  }

  .catalog-hero .lead {
    color: white; /* ‚Üê Cambio a blanco */
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 2rem;
    text-shadow: 
      2px 2px 6px rgba(0, 0, 0, 0.9),
      0 0 15px rgba(0, 0, 0, 0.7);
  }

  .header-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .btn-telegram,
  .btn-discord {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 15px 30px;
    border-radius: 30px;
    font-weight: 600;
    font-size: 1.1rem;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4); /* Sombra m√°s fuerte */
  }

  .btn-telegram {
    background: linear-gradient(135deg, #0088cc, #00a0dc);
    color: white;
  }

  .btn-telegram:hover {
    background: linear-gradient(135deg, #006ba0, #0088cc);
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 136, 204, 0.6);
  }

  .btn-telegram .icon {
    font-size: 1.3rem;
  }

  .btn-discord {
    background: linear-gradient(135deg, #5865f2, #7289da);
    color: white;
  }

  .btn-discord:hover {
    background: linear-gradient(135deg, #4752c4, #5865f2);
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(88, 101, 242, 0.6);
  }

  .btn-discord .icon {
    font-size: 1.3rem;
  }

  /* Indicadores de video con fondo para que se vean */
  .video-hero-dots {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 4;
    display: flex;
    gap: 12px;
    background: rgba(0, 0, 0, 0.4); /* Fondo oscuro */
    padding: 10px 20px;
    border-radius: 30px;
    backdrop-filter: blur(10px);
  }

  .video-hero-dots .dot {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.6);
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid white;
  }

  .video-hero-dots .dot.active {
    background: white;
    transform: scale(1.4);
    box-shadow: 0 0 15px rgba(255, 255, 255, 1);
  }

  .video-hero-dots .dot:hover {
    background: rgba(255, 255, 255, 0.9);
    transform: scale(1.2);
  }

  /* Botones de navegaci√≥n con mejor visibilidad */
  .video-hero-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.5); /* Fondo m√°s oscuro */
    backdrop-filter: blur(10px);
    border: 3px solid white;
    color: white;
    font-size: 2.5rem;
    font-weight: bold;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 4;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .video-hero-nav:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-50%) scale(1.15);
    box-shadow: 0 4px 20px rgba(204, 60, 192, 0.5);
  }

  .video-hero-nav.prev {
    left: 30px;
  }

  .video-hero-nav.next {
    right: 30px;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .catalog-hero {
      min-height: 400px;
      border-radius: 30px;
      border-width: 5px;
    }

    .catalog-hero::before {
      border-radius: 22px;
    }

    .catalog-hero-inner {
      padding: 60px 20px;
    }

    .catalog-hero h1 {
      font-size: 2.5rem;
    }

    .catalog-hero .lead {
      font-size: 1.1rem;
    }

    .btn-telegram,
    .btn-discord {
      padding: 12px 24px;
      font-size: 1rem;
    }

    .video-hero-nav {
      width: 45px;
      height: 45px;
      font-size: 1.8rem;
    }

    .video-hero-nav.prev {
      left: 15px;
    }

    .video-hero-nav.next {
      right: 15px;
    }

    .video-hero-dots {
      bottom: 20px;
      padding: 8px 15px;
    }

    .video-hero-dots .dot {
      width: 10px;
      height: 10px;
      border-width: 2px;
    }
  }
  </style>
</head>
<body class="pink-theme">

  <!-- Header SIMPLE -->
  <header class="topbar">
    <div class="container topbar-inner">
      <div class="brand">
        <div class="logo-badge" aria-hidden="true">üéüÔ∏è</div>
        <h1>Musical monitor</h1>
      </div>
 
      <div class="controls">
        <div class="search-wrap">
          <span class="search-icon" aria-hidden="true">üîé</span>
          <input id="search" placeholder="Buscar musical..." />
        </div>
        <label class="auto-refresh" aria-live="polite">
        </label>
        <div class="last-checked">‚è±Ô∏è <small class="lc-label">√öltima verificaci√≥n</small> <span id="last-checked">--</span></div>
        <div class="last-checked">üìù <small class="lc-label">√öltimos cambios</small> <span id="last-changes">--</span></div>
        <a href="/calendar" class="btn small" style="text-decoration:none">üìÖ Ver calendario</a>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Hero Banner CON VIDEOS Y BORDE AMARILLO -->
    <div class="catalog-hero">
      <!-- Videos de fondo -->
      <div class="video-hero-background">
        <video class="hero-video active" muted loop playsinline preload="auto" autoplay>
          <source src="/static/videos/video1.mp4" type="video/mp4">
        </video>
        <video class="hero-video" muted loop playsinline preload="auto">
          <source src="/static/videos/video2.mp4" type="video/mp4">
        </video>
        <video class="hero-video" muted loop playsinline preload="auto">
          <source src="/static/videos/video3.mp4" type="video/mp4">
        </video>
        <video class="hero-video" muted loop playsinline preload="auto">
          <source src="/static/videos/video4.webm" type="video/webm">
        </video>
        <video class="hero-video" muted loop playsinline preload="auto">
          <source src="/static/videos/video5.mp4" type="video/mp4">
        </video>
        <video class="hero-video" muted loop playsinline preload="auto">
          <source src="/static/videos/video6.mp4" type="video/mp4">
        </video>
        <video class="hero-video" muted loop playsinline preload="auto">
          <source src="/static/videos/video7.mp4" type="video/mp4">
        </video>
        <video class="hero-video" muted loop playsinline preload="auto">
          <source src="/static/videos/video8.mp4" type="video/mp4">
        </video>
        <iframe class="hero-video" 
          src="https://www.youtube.com/embed/jSkL4TLAyiM?autoplay=1&mute=1&loop=1&playlist=jSkL4TLAyiM&controls=0&showinfo=0&rel=0&modestbranding=1&iv_load_policy=3"
          frameborder="0" 
          allow="autoplay; encrypted-media"
          allowfullscreen>
        </iframe>
        <video class="hero-video" muted loop playsinline preload="auto">
          <source src="/static/videos/video9.mp4" type="video/mp4">
        </video>
      </div>

      <!-- Botones de navegaci√≥n -->
      <button class="video-hero-nav prev" onclick="previousHeroVideo()">‚Äπ</button>
      <button class="video-hero-nav next" onclick="nextHeroVideo()">‚Ä∫</button>

      <!-- Indicadores -->
      <div class="video-hero-dots">
        <div class="dot active" onclick="goToHeroVideo(0)"></div>
        <div class="dot" onclick="goToHeroVideo(1)"></div>
        <div class="dot" onclick="goToHeroVideo(2)"></div>
        <div class="dot" onclick="goToHeroVideo(3)"></div>
        <div class="dot" onclick="goToHeroVideo(4)"></div>
        <div class="dot" onclick="goToHeroVideo(5)"></div>
        <div class="dot" onclick="goToHeroVideo(6)"></div>
        <div class="dot" onclick="goToHeroVideo(7)"></div>
        <div class="dot" onclick="goToHeroVideo(8)"></div>
      </div>

      <!-- Contenido (con emojis y texto) -->
      <div class="catalog-hero-inner">
        <h1>üé≠‚ú® Ticket Monitor</h1>
        <p class="lead">¬°√önete a nuestro canal de telegram o Discord para estar atentx a las novedades!</p>
        
        <div class="header-actions">
          <a href="{{ telegram_url }}" target="_blank" class="btn-telegram">
            <span class="icon">üì±</span> √önete a Telegram
          </a>
          <a href="{{ discord_url }}" target="_blank" class="btn-discord">
            <span class="icon">üí¨</span> √önete a Discord
          </a>
        </div>
      </div>
    </div>

    <!-- Secci√≥n de Musicales -->
    <section class="dashboard-section">
      <div class="section-header">
        <h2>üé™ Musicales üé≠</h2>
        <p class="section-subtitle">{{ musicals|length }} musicales en seguimiento</p>
      </div>

      {% if musicals %}
      <div class="musicals-grid">
        {% for musical in musicals %}
        <article class="musical-card collapsible" data-musical-id="{{ musical.id }}">
          <!-- Slideshow -->
          <div class="musical-slideshow" onclick="toggleCard(this)">
            {% if musical.images and musical.images|length > 0 %}
            <div class="slideshow-container">
              {% for image in musical.images %}
              <div class="slide {% if loop.first %}active{% endif %}">
                <img src="{{ image }}" alt="{{ musical.name }}" loading="lazy">
              </div>
              {% endfor %}
              
              {% if musical.images|length > 1 %}
              <button class="slide-btn prev" onclick="event.stopPropagation(); changeSlide(this, -1)">‚ùÆ</button>
              <button class="slide-btn next" onclick="event.stopPropagation(); changeSlide(this, 1)">‚ùØ</button>
              
              <div class="slide-dots">
                {% for image in musical.images %}
                <span class="dot {% if loop.first %}active{% endif %}" onclick="event.stopPropagation(); currentSlide(this, {{ loop.index0 }})"></span>
                {% endfor %}
              </div>
              {% endif %}
            </div>
            {% else %}
            <div class="slideshow-placeholder">
              <div class="placeholder-icon">üé≠</div>
              <p>{{ musical.name }}</p>
            </div>
            {% endif %}
          </div>

          <!-- Header de la card -->
          <div class="musical-card-header" onclick="toggleCard(this)">
            <h3 class="musical-title">{{ musical.name }}</h3>
            <div class="card-toggle">
              <span class="toggle-icon">‚ñº</span>
            </div>
          </div>
          
          <!-- Body de la card -->
          <div class="musical-card-body collapsed">
            <div class="badges">
              {% if musical.is_available %}
              <span class="badge badge-success">‚úÖ Disponible</span>
              {% else %}
              <span class="badge badge-danger">‚ùå Agotado</span>
              {% endif %}
            </div>

            <div class="musical-stats">
              <div class="stat">
                <span class="stat-icon">üîó</span>
                <div class="stat-info">
                  <span class="stat-label">Total Enlaces</span>
                  <span class="stat-value">{{ musical.links|length }}</span>
                </div>
              </div>
              
              <div class="stat">
                <span class="stat-icon">‚úÖ</span>
                <div class="stat-info">
                  <span class="stat-label">Disponibles</span>
                  <span class="stat-value">{{ musical.active_links }}</span>
                </div>
              </div>

              <div class="stat">
                <span class="stat-icon">‚ùå</span>
                <div class="stat-info">
                  <span class="stat-label">Agotados</span>
                  <span class="stat-value">{{ musical.sold_out_links }}</span>
                </div>
              </div>
            </div>

            <div class="musical-links">
              <h4 class="links-title">
                <span class="icon">üé´</span> 
                Enlaces monitoreados ({{ musical.links|length }})
              </h4>
              <ul class="links-list">
                {% for link in musical.links[:3] %}
                <li>
                  <a href="{{ link.url }}" target="_blank" rel="noopener noreferrer" class="link-item">
                    <span class="link-icon">üîó</span>
                    <span class="link-text">{{ link.url|replace('https://', '')|replace('http://', '')|truncate(43, True, '...') }}</span>
                    {% if link.is_available %}
                    <span class="status-badge available">‚úÖ</span>
                    {% else %}
                    <span class="status-badge sold-out">‚ùå</span>
                    {% endif %}
                    <span class="link-external">‚Üó</span>
                  </a>
                </li>
                {% endfor %}
                
                {% if musical.links|length > 3 %}
                <li class="more-links">
                  <button class="btn-text" onclick="toggleAllLinks(this)">
                    Ver {{ musical.links|length - 3 }} enlaces m√°s...
                  </button>
                </li>
                {% endif %}
              </ul>
              
              {% if musical.links|length > 3 %}
              <ul class="links-list-extra" style="display:none;">
                {% for link in musical.links[3:] %}
                <li>
                  <a href="{{ link.url }}" target="_blank" rel="noopener noreferrer" class="link-item">
                    <span class="link-icon">üîó</span>
                    <span class="link-text">{{ link.url|replace('https://', '')|replace('http://', '')|truncate(43, True, '...') }}</span>
                    {% if link.is_available %}
                    <span class="status-badge available">‚úÖ</span>
                    {% else %}
                    <span class="status-badge sold-out">‚ùå</span>
                    {% endif %}
                    <span class="link-external">‚Üó</span>
                  </a>
                </li>
                {% endfor %}
              </ul>
              {% endif %}
            </div>

            {% if musical.updated_at %}
            <div class="last-change">
              <span class="change-icon">üìù</span>
              <span class="change-text">Actualizado: {{ musical.updated_at.strftime('%d/%m/%Y %H:%M') }}</span>
            </div>
            {% endif %}
          </div>

          <!-- Footer de la card -->
          <div class="musical-card-footer collapsed">
            <a href="/calendar" class="btn btn-primary">
              <span>Ver calendario</span>
              <span class="btn-icon">üìÖ</span>
            </a>
          </div>
        </article>
        {% endfor %}
      </div>
      {% else %}
      <div class="empty-state">
        <div class="empty-icon">üé≠</div>
        <h3>No hay musicales monitoreados</h3>
        <p>A√±ade tu primer musical para empezar a monitorear entradas</p>
      </div>
      {% endif %}
    </section>

    <!-- Quick Stats -->
    <section class="stats-section">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üé´</div>
          <div class="stat-content">
            <h4>Total Enlaces</h4>
            <p class="stat-number">
              {% set total = namespace(value=0) %}
              {% for musical in musicals %}
                {% set total.value = total.value + musical.links|length %}
              {% endfor %}
              {{ total.value }}
            </p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">üé™</div>
          <div class="stat-content">
            <h4>Musicales</h4>
            <p class="stat-number">{{ musicals|length }}</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">‚ö°</div>
          <div class="stat-content">
            <h4>Estado</h4>
            <p class="stat-status">‚úÖ Activo</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Inline suggestion card -->
    <section id="inline-suggest" class="suggestion-card fade-in" aria-labelledby="suggest-inline-title">
      <h3 id="suggest-inline-title">üíå Enviar sugerencia</h3>
      <form id="inline-suggest-form" class="suggestion-form" novalidate>
        <div class="row">
          <label>Nombre del Musical *<br>
            <input name="siteName" type="text" placeholder="Ej. The Book of Mormon" required>
          </label>
          <label>URL del sitio *<br>
            <input name="siteUrl" type="url" placeholder="https://tickets.ejemplo.com" required>
          </label>
        </div>

        <label>¬øPor qu√© deber√≠amos monitorearlo?<br>
          <textarea name="reason" rows="3" placeholder="Opcional: cu√©ntanos qu√© parte de la web te interesa monitorear..."></textarea>
        </label>

        <div class="suggest-controls">
          <button type="submit" class="btn primary">‚ú® Enviar Sugerencia</button>
          <button type="reset" class="btn ghost">Limpiar</button>
          <div id="inline-suggest-status" class="suggest-status" aria-live="polite"></div>
        </div>
      </form>
    </section>
  </main>

  <footer class="footer">
    <small>Made with üíñ ‚Äî dynamic cute monitor</small>
  </footer>

  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script>
    // ==================== VIDEO HERO CAROUSEL ====================
    let currentHeroVideoIndex = 0;
    let heroVideos = document.querySelectorAll('.hero-video');
    let heroDots = document.querySelectorAll('.video-hero-dots .dot');
    let heroVideoInterval;

    function goToHeroVideo(index) {
      heroVideos[currentHeroVideoIndex].pause();
      heroVideos[currentHeroVideoIndex].classList.remove('active');
      heroDots[currentHeroVideoIndex].classList.remove('active');

      currentHeroVideoIndex = index;
      heroVideos[currentHeroVideoIndex].classList.add('active');
      heroDots[currentHeroVideoIndex].classList.add('active');
      heroVideos[currentHeroVideoIndex].play();

      resetHeroVideoInterval();
    }

    function nextHeroVideo() {
      goToHeroVideo((currentHeroVideoIndex + 1) % heroVideos.length);
    }

    function previousHeroVideo() {
      goToHeroVideo((currentHeroVideoIndex - 1 + heroVideos.length) % heroVideos.length);
    }

    function startHeroVideoAutoPlay() {
      heroVideoInterval = setInterval(nextHeroVideo, 10000);
    }

    function resetHeroVideoInterval() {
      clearInterval(heroVideoInterval);
      startHeroVideoAutoPlay();
    }

    heroVideos.forEach((video) => {
      video.addEventListener('ended', () => {
        nextHeroVideo();
      });
    });

    document.addEventListener('DOMContentLoaded', () => {
      if (heroVideos.length > 0) {
        heroVideos[0].play();
        startHeroVideoAutoPlay();

        document.querySelector('.catalog-hero').addEventListener('mouseenter', () => {
          clearInterval(heroVideoInterval);
        });

        document.querySelector('.catalog-hero').addEventListener('mouseleave', () => {
          startHeroVideoAutoPlay();
        });
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') previousHeroVideo();
      if (e.key === 'ArrowRight') nextHeroVideo();
    });

    // ==================== RESTO DE FUNCIONES ====================
    function toggleCard(element) {
      const card = element.closest('.musical-card');
      const body = card.querySelector('.musical-card-body');
      const footer = card.querySelector('.musical-card-footer');
      const toggleIcon = card.querySelector('.toggle-icon');
      
      body.classList.toggle('collapsed');
      footer.classList.toggle('collapsed');
      card.classList.toggle('expanded');
      
      toggleIcon.textContent = body.classList.contains('collapsed') ? '‚ñº' : '‚ñ≤';
    }

    function toggleAllLinks(button) {
      const card = button.closest('.musical-card');
      const extraLinks = card.querySelector('.links-list-extra');
      
      if (extraLinks.style.display === 'none') {
        extraLinks.style.display = 'block';
        button.textContent = 'Ver menos...';
      } else {
        extraLinks.style.display = 'none';
        const hiddenCount = extraLinks.querySelectorAll('li').length;
        button.textContent = `Ver ${hiddenCount} enlaces m√°s...`;
      }
    }

    function changeSlide(button, direction) {
      const container = button.closest('.slideshow-container');
      const slides = container.querySelectorAll('.slide');
      const dots = container.querySelectorAll('.dot');
      
      let currentIndex = Array.from(slides).findIndex(s => s.classList.contains('active'));
      
      slides[currentIndex].classList.remove('active');
      dots[currentIndex].classList.remove('active');
      
      currentIndex = (currentIndex + direction + slides.length) % slides.length;
      
      slides[currentIndex].classList.add('active');
      dots[currentIndex].classList.add('active');
    }

    function currentSlide(dot, index) {
      const container = dot.closest('.slideshow-container');
      const slides = container.querySelectorAll('.slide');
      const dots = container.querySelectorAll('.dot');
      
      slides.forEach(s => s.classList.remove('active'));
      dots.forEach(d => d.classList.remove('active'));
      
      slides[index].classList.add('active');
      dots[index].classList.add('active');
    }

    setInterval(() => {
      document.querySelectorAll('.slideshow-container').forEach(container => {
        const nextBtn = container.querySelector('.next');
        if (nextBtn) changeSlide(nextBtn, 1);
      });
    }, 5000);
  </script>
</body>
</html>