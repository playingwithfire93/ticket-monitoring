import requests
from datetime import datetime
import sys
from pathlib import Path

# Añadir la raíz del proyecto al path
ROOT_DIR = Path(__file__).parent.parent.parent
sys.path.insert(0, str(ROOT_DIR))

from app import app, db
from models import Musical, MusicalLink
import config

URLS = [
    # ██╗    ██╗██╗ ██████╗██╗  ██╗███████╗██████╗ 
    # ██║    ██║██║██╔════╝██║ ██╔╝██╔════╝██╔══██╗
    # ██║ █╗ ██║██║██║     █████╔╝ █████╗  ██║  ██║
    # ██║███╗██║██║██║     ██╔═██╗ ██╔══╝  ██║  ██║
    # ╚███╔███╔╝██║╚██████╗██║  ██╗███████╗██████╔╝
    # ╚══╝╚══╝ ╚═╝ ╚═════╝╚═╝  ╚═╝╚══════╝╚═════╝                                                 
    'https://wickedelmusical.com/',
    'https://wickedelmusical.com/elenco',
    'https://tickets.wickedelmusical.com/espectaculo/wicked-el-musical/W01',
    #██╗  ██╗ ██████╗ ██╗   ██╗██████╗ ██╗███╗   ██╗██╗
    #██║  ██║██╔═══██╗██║   ██║██╔══██╗██║████╗  ██║██║
    #███████║██║   ██║██║   ██║██║  ██║██║██╔██╗ ██║██║
    #██╔══██║██║   ██║██║   ██║██║  ██║██║██║╚██╗██║██║
    #██║  ██║╚██████╔╝╚██████╔╝██████╔╝██║██║ ╚████║██║
    #╚═╝  ╚═╝ ╚═════╝  ╚═════╝ ╚═════╝ ╚═╝╚═╝  ╚═══╝╚═╝
    'https://www.houdinielmusical.com',
    #'https://tickets.oneboxtds.com/teatro-calderon/events/45581?_gl=1*kh3tzd*_gcl_au*Njc1MDExMzU3LjE3NDk0NjUxMjM.&sessionView=LIST',
    # ██╗     ███████╗███████╗    ███╗   ███╗██╗███████╗███████╗██████╗  █████╗ ██████╗ ██╗     ███████╗███████╗
    # ██║     ██╔════╝██╔════╝    ████╗ ████║██║██╔════╝██╔════╝██╔══██╗██╔══██╗██╔══██╗██║     ██╔════╝██╔════╝
    # ██║     █████╗  ███████╗    ██╔████╔██║██║███████╗█████╗  ██████╔╝███████║██████╔╝██║     █████╗  ███████╗
    # ██║     ██╔══╝  ╚════██║    ██║╚██╔╝██║██║╚════██║██╔══╝  ██╔══██╗██╔══██║██╔══██╗██║     ██╔══╝  ╚════██║
    # ███████╗███████╗███████║    ██║ ╚═╝ ██║██║███████║███████╗██║  ██║██║  ██║██████╔╝███████╗███████╗███████║
    # ╚══════╝╚══════╝╚══════╝    ╚═╝     ╚═╝╚═╝╚══════╝╚══════╝╚═╝  ╚═╝╚═╝  ╚═╝╚═════╝ ╚══════╝╚══════╝╚══════╝                                                                                                    
    'https://miserableselmusical.es/',
    'https://miserableselmusical.es/elenco',
    'https://tickets.miserableselmusical.es/espectaculo/los-miserables/M01',
    # ████████╗██╗  ██╗███████╗    ██████╗  ██████╗  ██████╗ ██╗  ██╗     ██████╗ ███████╗    ███╗   ███╗ ██████╗ ██████╗ ███╗   ███╗ ██████╗ ███╗   ██╗
    # ╚══██╔══╝██║  ██║██╔════╝    ██╔══██╗██╔═══██╗██╔═══██╗██║ ██╔╝    ██╔═══██╗██╔════╝    ████╗ ████║██╔═══██╗██╔══██╗████╗ ████║██╔═══██╗████╗  ██║
    #    ██║   ███████║█████╗      ██████╔╝██║   ██║██║   ██║█████╔╝     ██║   ██║█████╗      ██╔████╔██║██║   ██║██████╔╝██╔████╔██║██║   ██║██╔██╗ ██║
    #    ██║   ██╔══██║██╔══╝      ██╔══██╗██║   ██║██║   ██║██╔═██╗     ██║   ██║██╔══╝      ██║╚██╔╝██║██║   ██║██╔══██╗██║╚██╔╝██║██║   ██║██║╚██╗██║
    #    ██║   ██║  ██║███████╗    ██████╔╝╚██████╔╝╚██████╔╝██║  ██╗    ╚██████╔╝██║         ██║ ╚═╝ ██║╚██████╔╝██║  ██║██║ ╚═╝ ██║╚██████╔╝██║ ╚████║
    #    ╚═╝   ╚═╝  ╚═╝╚══════╝    ╚═════╝  ╚═════╝  ╚═════╝ ╚═╝  ╚═╝     ╚═════╝ ╚═╝         ╚═╝     ╚═╝ ╚═════╝ ╚═╝  ╚═╝╚═╝     ╚═╝ ╚═════╝ ╚═╝  ╚═══╝                                                                                                                                             
    'https://thebookofmormonelmusical.es',
    'https://thebookofmormonelmusical.es/elenco/',
    'https://tickets.thebookofmormonelmusical.es/espectaculo/the-book-of-mormon-el-musical/BM01',
    # ██████╗ ██╗   ██╗███████╗ ██████╗ █████╗ ███╗   ██╗██████╗  ██████╗      █████╗      █████╗ ██╗   ██╗██████╗ ██████╗ ███████╗██╗   ██╗
    # ██╔══██╗██║   ██║██╔════╝██╔════╝██╔══██╗████╗  ██║██╔══██╗██╔═══██╗    ██╔══██╗    ██╔══██╗██║   ██║██╔══██╗██╔══██╗██╔════╝╚██╗ ██╔╝
    # ██████╔╝██║   ██║███████╗██║     ███████║██╔██╗ ██║██║  ██║██║   ██║    ███████║    ███████║██║   ██║██║  ██║██████╔╝█████╗   ╚████╔╝ 
    # ██╔══██╗██║   ██║╚════██║██║     ██╔══██║██║╚██╗██║██║  ██║██║   ██║    ██╔══██║    ██╔══██║██║   ██║██║  ██║██╔══██╗██╔══╝    ╚██╔╝  
    # ██████╔╝╚██████╔╝███████║╚██████╗██║  ██║██║ ╚████║██████╔╝╚██████╔╝    ██║  ██║    ██║  ██║╚██████╔╝██████╔╝██║  ██║███████╗   ██║   
    # ╚═════╝  ╚═════╝ ╚══════╝ ╚═════╝╚═╝  ╚═╝╚═╝  ╚═══╝╚═════╝  ╚═════╝     ╚═╝  ╚═╝    ╚═╝  ╚═╝ ╚═════╝ ╚═════╝ ╚═╝  ╚═╝╚══════╝   ╚═╝                                                                                                                                
    'https://buscandoaaudrey.com'
]

results = []

def check_sites():
    global results
    new_results = []
    now = datetime.now().strftime("%Y-%m-%d %H:%M:%S")

    for url in URLS:
        try:
            res = requests.get(url, timeout=10)
            if "date_info" in res.text:
                new_results.append(f"[{now}] {url} OK ✅")
            else:
                new_results.append(f"[{now}] {url} ❌ CHANGE or missing")
        except Exception as e:
            new_results.append(f"[{now}] {url} ❌ ERROR: {e}")

    results[:] = new_results
